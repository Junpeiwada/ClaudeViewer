<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <h1>ğŸ”ï¸ Claude Code Viewer</h1>
                <div class="status-info">
                    <span id="status-text">Ready</span>
                </div>
            </div>
            <div class="header-right">
                <button id="refresh-btn" class="header-btn">
                    <span>ğŸ”„</span> æ›´æ–°
                </button>
                <button id="settings-btn" class="header-btn">
                    <span>âš™ï¸</span> è¨­å®š
                </button>
            </div>
        </header>
        
        <main class="main-content">
            <div class="content-panes">
                <aside class="project-pane">
                    <div class="pane-header">
                        <h3>ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h3>
                    </div>
                    <div class="project-list" id="project-list">
                        <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                    </div>
                </aside>
                
                <section class="file-pane">
                    <div class="file-list-container">
                        <table class="file-list" id="file-list">
                            <thead>
                                <tr>
                                    <th id="sort-name" class="sortable" data-sort="name">
                                        ãƒ•ã‚¡ã‚¤ãƒ«å <span class="sort-arrow"></span>
                                    </th>
                                    <th id="sort-date" class="sortable active" data-sort="date">
                                        æ›´æ–°æ—¥æ™‚ <span class="sort-arrow">â–¼</span>
                                    </th>
                                    <th id="sort-size" class="sortable" data-sort="size">
                                        ã‚µã‚¤ã‚º <span class="sort-arrow"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="file-list-body">
                                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
        
        <footer class="app-footer">
            <div class="footer-content">
                <div class="status-left">
                    <span id="status-message">Ready</span>
                </div>
                <div class="status-right">
                    <span id="selection-info">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœªé¸æŠ</span>
                    <span id="theme-indicator">ğŸŒ™</span>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã®ä»®ãƒ‡ãƒ¼ã‚¿
        const mockProjects = [
            { name: "MyProject", path: "/Users/user/.claude/projects/MyProject" },
            { name: "TestProject", path: "/Users/user/.claude/projects/TestProject" },
            { name: "DemoApp", path: "/Users/user/.claude/projects/DemoApp" },
            { name: "WebApp", path: "/Users/user/.claude/projects/WebApp" }
        ];
        
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿
        const projectFiles = {
            "MyProject": [
                { name: "session_001.jsonl", date: "2024-01-15 14:30", size: "1.2MB", fullPath: "/path/MyProject/file1" },
                { name: "session_002.jsonl", date: "2024-01-14 09:15", size: "2.8MB", fullPath: "/path/MyProject/file2" },
                { name: "conversation_003.jsonl", date: "2024-01-13 16:45", size: "0.9MB", fullPath: "/path/MyProject/file3" }
            ],
            "TestProject": [
                { name: "test_session_001.jsonl", date: "2024-01-12 11:20", size: "1.8MB", fullPath: "/path/TestProject/file1" },
                { name: "debug_002.jsonl", date: "2024-01-11 08:45", size: "3.2MB", fullPath: "/path/TestProject/file2" }
            ],
            "DemoApp": [
                { name: "demo_conversation.jsonl", date: "2024-01-10 15:30", size: "2.1MB", fullPath: "/path/DemoApp/file1" },
                { name: "demo_session_002.jsonl", date: "2024-01-09 10:15", size: "1.5MB", fullPath: "/path/DemoApp/file2" },
                { name: "demo_test.jsonl", date: "2024-01-08 14:20", size: "0.7MB", fullPath: "/path/DemoApp/file3" },
                { name: "demo_final.jsonl", date: "2024-01-07 16:45", size: "2.9MB", fullPath: "/path/DemoApp/file4" }
            ],
            "WebApp": [
                { name: "webapp_session.jsonl", date: "2024-01-06 09:30", size: "1.1MB", fullPath: "/path/WebApp/file1" }
            ]
        };

        // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªãƒ­ã‚¸ãƒƒã‚¯
        let selectedProject = null;
        let selectedFile = null;
        let currentSort = { column: 'date', ascending: false }; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šæ—¥æ™‚é™é †

        function updateStatus(message) {
            const statusElement = document.getElementById('status-message');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        function updateSelectionInfo() {
            const selectionElement = document.getElementById('selection-info');
            if (!selectionElement) return;
            
            let info = '';
            if (selectedProject) {
                const fileCount = (projectFiles[selectedProject.name] || []).length;
                info = `${selectedProject.name} - ${fileCount} files`;
                if (selectedFile) {
                    info += ` - ${selectedFile.name}`;
                }
            } else {
                info = 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœªé¸æŠ';
            }
            selectionElement.textContent = info;
        }

        function loadProjects() {
            const projectList = document.getElementById('project-list');
            
            if (!projectList) {
                console.error('project-list element not found!');
                return;
            }

            projectList.innerHTML = '';
            
            mockProjects.forEach(project => {
                const projectElement = document.createElement('div');
                projectElement.className = 'project-item';
                projectElement.innerHTML = `
                    <span class="project-icon">ğŸ“</span>
                    <span class="project-name">${project.name}</span>
                `;
                
                projectElement.addEventListener('click', () => {
                    selectProject(project);
                });
                
                projectList.appendChild(projectElement);
            });
        }

        function selectProject(project) {
            selectedProject = project;
            
            // é¸æŠçŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const projectElements = Array.from(document.querySelectorAll('.project-item'));
            const selectedElement = projectElements.find(element => 
                element.querySelector('.project-name')?.textContent === project.name
            );
            selectedElement?.classList.add('selected');
            
            loadFiles();
            updateSelectionInfo();
        }

        function sortFiles(files, column, ascending) {
            return [...files].sort((a, b) => {
                let valueA, valueB;
                
                switch(column) {
                    case 'name':
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                        break;
                    case 'date':
                        valueA = new Date(a.date.replace(' ', 'T'));
                        valueB = new Date(b.date.replace(' ', 'T'));
                        break;
                    case 'size':
                        // ã‚µã‚¤ã‚ºã‚’æ•°å€¤ã«å¤‰æ›ï¼ˆMBå˜ä½ï¼‰
                        valueA = parseFloat(a.size.replace('MB', ''));
                        valueB = parseFloat(b.size.replace('MB', ''));
                        break;
                    default:
                        return 0;
                }
                
                if (valueA < valueB) return ascending ? -1 : 1;
                if (valueA > valueB) return ascending ? 1 : -1;
                return 0;
            });
        }

        function updateSortHeaders() {
            // å…¨ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('active');
                th.querySelector('.sort-arrow').textContent = '';
            });
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚½ãƒ¼ãƒˆã‚«ãƒ©ãƒ ã‚’è¨­å®š
            const activeHeader = document.querySelector(`[data-sort="${currentSort.column}"]`);
            if (activeHeader) {
                activeHeader.classList.add('active');
                const arrow = activeHeader.querySelector('.sort-arrow');
                if (arrow) {
                    arrow.textContent = currentSort.ascending ? 'â–²' : 'â–¼';
                }
            }
        }

        function loadFiles() {
            const fileListBody = document.getElementById('file-list-body');
            
            if (!fileListBody || !selectedProject) {
                console.error('file-list-body not found or no project selected');
                return;
            }

            fileListBody.innerHTML = '';
            
            // é¸æŠã•ã‚ŒãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
            const rawFiles = projectFiles[selectedProject.name] || [];
            
            // ã‚½ãƒ¼ãƒˆé©ç”¨
            const sortedFiles = sortFiles(rawFiles, currentSort.column, currentSort.ascending);
            
            sortedFiles.forEach(file => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>ğŸ“„ ${file.name}</td>
                    <td>${file.date}</td>
                    <td>${file.size}</td>
                `;
                
                row.addEventListener('click', () => {
                    selectFile(file);
                });
                
                row.addEventListener('dblclick', () => {
                    console.log('Opening file:', file.name);
                    updateStatus(`ãƒ•ã‚¡ã‚¤ãƒ«é–‹ã: ${file.name}`);
                    setTimeout(() => updateStatus('Ready'), 1000);
                });
                
                fileListBody.appendChild(row);
            });

            // ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã§è¡¨ç¤ºï¼ˆupdateSelectionInfoå†…ï¼‰

            // ã‚½ãƒ¼ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›´æ–°
            updateSortHeaders();
        }

        function selectFile(file) {
            selectedFile = file;
            
            document.querySelectorAll('.file-list tbody tr').forEach(row => {
                row.classList.remove('selected');
            });
            
            const fileRows = Array.from(document.querySelectorAll('.file-list tbody tr'));
            const selectedRow = fileRows.find(row => 
                row.textContent?.includes(file.name)
            );
            selectedRow?.classList.add('selected');
            
            updateSelectionInfo();
        }

        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            const refreshBtn = document.getElementById('refresh-btn');
            const settingsBtn = document.getElementById('settings-btn');
            
            refreshBtn?.addEventListener('click', () => {
                updateStatus('æ›´æ–°ä¸­...');
                setTimeout(() => {
                    loadProjects();
                    updateStatus('æ›´æ–°å®Œäº†');
                    setTimeout(() => updateStatus('Ready'), 1000);
                }, 500);
            });
            
            settingsBtn?.addEventListener('click', () => {
                updateStatus('è¨­å®šç”»é¢ï¼ˆæœªå®Ÿè£…ï¼‰');
                setTimeout(() => updateStatus('Ready'), 1000);
            });

            // ã‚½ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.getAttribute('data-sort');
                    
                    if (currentSort.column === column) {
                        // åŒã˜ã‚«ãƒ©ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯æ˜‡é †/é™é †ã‚’åˆ‡ã‚Šæ›¿ãˆ
                        currentSort.ascending = !currentSort.ascending;
                    } else {
                        // ç•°ãªã‚‹ã‚«ãƒ©ãƒ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯æ–°ã—ã„ã‚«ãƒ©ãƒ ã§é™é †
                        currentSort.column = column;
                        currentSort.ascending = false;
                    }
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿ï¼ˆã‚½ãƒ¼ãƒˆé©ç”¨ï¼‰
                    if (selectedProject) {
                        loadFiles();
                    }
                });
            });

            // ãƒ†ãƒ¼ãƒåˆæœŸåŒ–
            updateTheme();
            
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿
            loadProjects();
            updateStatus('Ready');
        });

        function updateTheme() {
            const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const themeIndicator = document.getElementById('theme-indicator');
            if (themeIndicator) {
                themeIndicator.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
            }
        }

        // ãƒ†ãƒ¼ãƒå¤‰æ›´ç›£è¦–
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme);
        }
    </script>
</body>
</html>
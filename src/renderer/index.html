<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <h1>üèîÔ∏è Claude Code Viewer</h1>
                <div class="status-info">
                    <span id="status-text">Ready</span>
                </div>
            </div>
            <div class="header-right">
                <button id="refresh-btn" class="header-btn">
                    <span>üîÑ</span> Êõ¥Êñ∞
                </button>
                <button id="settings-btn" class="header-btn">
                    <span>‚öôÔ∏è</span> Ë®≠ÂÆö
                </button>
            </div>
        </header>
        
        <main class="main-content">
            <div class="content-panes">
                <aside class="project-pane">
                    <div class="pane-header">
                        <h3>üìÅ „Éó„É≠„Ç∏„Çß„ÇØ„Éà‰∏ÄË¶ß</h3>
                    </div>
                    <div class="project-list" id="project-list">
                        <!-- „Éó„É≠„Ç∏„Çß„ÇØ„Éà‰∏ÄË¶ß„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                    </div>
                </aside>
                
                <section class="file-pane">
                    <div class="file-list-container">
                        <table class="file-list" id="file-list">
                            <thead>
                                <tr>
                                    <th id="sort-name" class="sortable" data-sort="name">
                                        „Éï„Ç°„Ç§„É´Âêç <span class="sort-arrow"></span>
                                    </th>
                                    <th id="sort-date" class="sortable active" data-sort="date">
                                        Êõ¥Êñ∞Êó•ÊôÇ <span class="sort-arrow">‚ñº</span>
                                    </th>
                                    <th id="sort-size" class="sortable" data-sort="size">
                                        „Çµ„Ç§„Ç∫ <span class="sort-arrow"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="file-list-body">
                                <!-- „Éï„Ç°„Ç§„É´‰∏ÄË¶ß„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
        
        <footer class="app-footer">
            <div class="footer-content">
                <div class="status-left">
                    <span id="status-message">Ready</span>
                </div>
                <div class="status-right">
                    <span id="selection-info">„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊú™ÈÅ∏Êäû</span>
                    <span id="theme-indicator">üåô</span>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        
        // „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂà•„ÅÆ‰ªÆ„Éá„Éº„Çø
        const mockProjects = [
            { name: "MyProject", path: "/Users/user/.claude/projects/MyProject" },
            { name: "TestProject", path: "/Users/user/.claude/projects/TestProject" },
            { name: "DemoApp", path: "/Users/user/.claude/projects/DemoApp" },
            { name: "WebApp", path: "/Users/user/.claude/projects/WebApp" }
        ];
        
        // „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂà•„ÅÆ„Éï„Ç°„Ç§„É´„Éá„Éº„Çø
        const projectFiles = {
            "MyProject": [
                { name: "session_001.jsonl", date: "2024-01-15 14:30", size: "1.2MB", fullPath: "/path/MyProject/file1" },
                { name: "session_002.jsonl", date: "2024-01-14 09:15", size: "2.8MB", fullPath: "/path/MyProject/file2" },
                { name: "conversation_003.jsonl", date: "2024-01-13 16:45", size: "0.9MB", fullPath: "/path/MyProject/file3" }
            ],
            "TestProject": [
                { name: "test_session_001.jsonl", date: "2024-01-12 11:20", size: "1.8MB", fullPath: "/path/TestProject/file1" },
                { name: "debug_002.jsonl", date: "2024-01-11 08:45", size: "3.2MB", fullPath: "/path/TestProject/file2" }
            ],
            "DemoApp": [
                { name: "demo_conversation.jsonl", date: "2024-01-10 15:30", size: "2.1MB", fullPath: "/path/DemoApp/file1" },
                { name: "demo_session_002.jsonl", date: "2024-01-09 10:15", size: "1.5MB", fullPath: "/path/DemoApp/file2" },
                { name: "demo_test.jsonl", date: "2024-01-08 14:20", size: "0.7MB", fullPath: "/path/DemoApp/file3" },
                { name: "demo_final.jsonl", date: "2024-01-07 16:45", size: "2.9MB", fullPath: "/path/DemoApp/file4" }
            ],
            "WebApp": [
                { name: "webapp_session.jsonl", date: "2024-01-06 09:30", size: "1.1MB", fullPath: "/path/WebApp/file1" }
            ]
        };

        // „Ç∑„É≥„Éó„É´„Å™„Ç¢„Éó„É™„É≠„Ç∏„ÉÉ„ÇØ
        let selectedProject = null;
        let selectedFile = null;
        let currentSort = { column: 'date', ascending: false }; // „Éá„Éï„Ç©„É´„ÉàÔºöÊó•ÊôÇÈôçÈ†Ü

        function updateStatus(message) {
            const statusElement = document.getElementById('status-message');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        function updateSelectionInfo() {
            const selectionElement = document.getElementById('selection-info');
            if (!selectionElement) return;
            
            let info = '';
            if (selectedProject) {
                const fileCount = (projectFiles[selectedProject.name] || []).length;
                info = `${selectedProject.name} - ${fileCount} files`;
                if (selectedFile) {
                    info += ` - ${selectedFile.name}`;
                }
            } else {
                info = '„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊú™ÈÅ∏Êäû';
            }
            selectionElement.textContent = info;
        }

        function loadProjects() {
            const projectList = document.getElementById('project-list');
            
            if (!projectList) {
                console.error('project-list element not found!');
                return;
            }

            projectList.innerHTML = '';
            
            mockProjects.forEach(project => {
                const projectElement = document.createElement('div');
                projectElement.className = 'project-item';
                projectElement.innerHTML = `
                    <span class="project-icon">üìÅ</span>
                    <span class="project-name">${project.name}</span>
                `;
                
                projectElement.addEventListener('click', () => {
                    selectProject(project);
                });
                
                projectList.appendChild(projectElement);
            });
        }

        function selectProject(project) {
            selectedProject = project;
            
            // ÈÅ∏ÊäûÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const projectElements = Array.from(document.querySelectorAll('.project-item'));
            const selectedElement = projectElements.find(element => 
                element.querySelector('.project-name')?.textContent === project.name
            );
            selectedElement?.classList.add('selected');
            
            loadFiles();
            updateSelectionInfo();
        }

        function sortFiles(files, column, ascending) {
            return [...files].sort((a, b) => {
                let valueA, valueB;
                
                switch(column) {
                    case 'name':
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                        break;
                    case 'date':
                        valueA = new Date(a.date.replace(' ', 'T'));
                        valueB = new Date(b.date.replace(' ', 'T'));
                        break;
                    case 'size':
                        // „Çµ„Ç§„Ç∫„ÇíÊï∞ÂÄ§„Å´Â§âÊèõÔºàMBÂçò‰ΩçÔºâ
                        valueA = parseFloat(a.size.replace('MB', ''));
                        valueB = parseFloat(b.size.replace('MB', ''));
                        break;
                    default:
                        return 0;
                }
                
                if (valueA < valueB) return ascending ? -1 : 1;
                if (valueA > valueB) return ascending ? 1 : -1;
                return 0;
            });
        }

        function updateSortHeaders() {
            // ÂÖ®„Å¶„ÅÆ„Éò„ÉÉ„ÉÄ„Éº„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('active');
                th.querySelector('.sort-arrow').textContent = '';
            });
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„ÇΩ„Éº„Éà„Ç´„É©„É†„ÇíË®≠ÂÆö
            const activeHeader = document.querySelector(`[data-sort="${currentSort.column}"]`);
            if (activeHeader) {
                activeHeader.classList.add('active');
                const arrow = activeHeader.querySelector('.sort-arrow');
                if (arrow) {
                    arrow.textContent = currentSort.ascending ? '‚ñ≤' : '‚ñº';
                }
            }
        }

        function loadFiles() {
            const fileListBody = document.getElementById('file-list-body');
            
            if (!fileListBody || !selectedProject) {
                console.error('file-list-body not found or no project selected');
                return;
            }

            fileListBody.innerHTML = '';
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÂèñÂæó
            const rawFiles = projectFiles[selectedProject.name] || [];
            
            // „ÇΩ„Éº„ÉàÈÅ©Áî®
            const sortedFiles = sortFiles(rawFiles, currentSort.column, currentSort.ascending);
            
            sortedFiles.forEach(file => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>üìÑ ${file.name}</td>
                    <td>${file.date}</td>
                    <td>${file.size}</td>
                `;
                
                row.addEventListener('click', () => {
                    selectFile(file);
                });
                
                row.addEventListener('dblclick', () => {
                    console.log('Opening file:', file.name);
                    updateStatus(`„Éï„Ç°„Ç§„É´Èñã„Åè: ${file.name}`);
                    setTimeout(() => updateStatus('Ready'), 1000);
                });
                
                fileListBody.appendChild(row);
            });

            // „Éï„Ç°„Ç§„É´Êï∞„ÅØ„Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº„ÅßË°®Á§∫ÔºàupdateSelectionInfoÂÜÖÔºâ

            // „ÇΩ„Éº„Éà„Éò„ÉÉ„ÉÄ„Éº„ÇíÊõ¥Êñ∞
            updateSortHeaders();
        }

        function selectFile(file) {
            selectedFile = file;
            
            document.querySelectorAll('.file-list tbody tr').forEach(row => {
                row.classList.remove('selected');
            });
            
            const fileRows = Array.from(document.querySelectorAll('.file-list tbody tr'));
            const selectedRow = fileRows.find(row => 
                row.textContent?.includes(file.name)
            );
            selectedRow?.classList.add('selected');
            
            updateSelectionInfo();
        }

        // DOMË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            
            // „Éú„Çø„É≥„Ç§„Éô„É≥„Éà
            const refreshBtn = document.getElementById('refresh-btn');
            const settingsBtn = document.getElementById('settings-btn');
            
            refreshBtn?.addEventListener('click', () => {
                updateStatus('Êõ¥Êñ∞‰∏≠...');
                setTimeout(() => {
                    loadProjects();
                    updateStatus('Êõ¥Êñ∞ÂÆå‰∫Ü');
                    setTimeout(() => updateStatus('Ready'), 1000);
                }, 500);
            });
            
            settingsBtn?.addEventListener('click', () => {
                updateStatus('Ë®≠ÂÆöÁîªÈù¢ÔºàÊú™ÂÆüË£ÖÔºâ');
                setTimeout(() => updateStatus('Ready'), 1000);
            });

            // „ÇΩ„Éº„Éà„Ç§„Éô„É≥„Éà
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.getAttribute('data-sort');
                    
                    if (currentSort.column === column) {
                        // Âêå„Åò„Ç´„É©„É†„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÊòáÈ†Ü/ÈôçÈ†Ü„ÇíÂàá„ÇäÊõø„Åà
                        currentSort.ascending = !currentSort.ascending;
                    } else {
                        // Áï∞„Å™„Çã„Ç´„É©„É†„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØÊñ∞„Åó„ÅÑ„Ç´„É©„É†„ÅßÈôçÈ†Ü
                        currentSort.column = column;
                        currentSort.ascending = false;
                    }
                    
                    // „Éï„Ç°„Ç§„É´‰∏ÄË¶ß„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºà„ÇΩ„Éº„ÉàÈÅ©Áî®Ôºâ
                    if (selectedProject) {
                        loadFiles();
                    }
                });
            });

            // „ÉÜ„Éº„ÉûÂàùÊúüÂåñ
            updateTheme();
            
            // „Éó„É≠„Ç∏„Çß„ÇØ„ÉàË™≠„ÅøËæº„Åø
            loadProjects();
            updateStatus('Ready');
        });

        function updateTheme() {
            const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const themeIndicator = document.getElementById('theme-indicator');
            if (themeIndicator) {
                themeIndicator.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
            }
        }

        // „ÉÜ„Éº„ÉûÂ§âÊõ¥Áõ£Ë¶ñ
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme);
        }
    </script>
</body>
</html>
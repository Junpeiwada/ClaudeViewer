# Claude Code Viewer 実装計画

## 運用ルール

### 1. フェーズベース開発
- 各フェーズは独立した機能単位で構成
- フェーズ完了時に動作確認可能な成果物を提供
- 全フェーズ完了後に統合・最終調整を実施

### 2. 承認プロセス
- 各フェーズ完了時に成果物を提示
- ユーザーが実際にアプリを実行して動作確認
- 承認取得後に次フェーズへ進行
- 修正要望があれば該当フェーズ内で対応

### 3. 成果物の要件
- 動作するElectronアプリケーション
- 該当機能が実際に使用可能
- TypeScript + ESLint構成済み
- 実装内容と確認ポイントをドキュメント化

### 4. 進捗管理
- 各フェーズのタスク状態を明記
- 完了条件と確認事項を定義
- 依存関係と前提条件を整理

---

## フェーズ別実装計画

### ✅ Phase 1: プロジェクト基盤構築 【完了】
**目標**: Electronプロジェクトの初期設定とTypeScript環境構築

#### タスク一覧
- [x] **基盤-1**: Electronプロジェクト初期化
- [x] **基盤-2**: TypeScript設定 (tsconfig.json)
- [x] **基盤-3**: ESLint + Prettier設定
- [x] **基盤-4**: electron-builder設定
- [x] **基盤-5**: 基本的なメイン・レンダラープロセス構成

#### 成果物 ✅
- 起動可能なElectronアプリ（ウェルカム画面）
- ビルド・開発環境一式
- VSCode F5デバッグ実行対応
- F12キーによるDevTools開閉
- ウィンドウ終了時アプリ終了

#### 確認ポイント ✅
- `npm run dev` でアプリが起動する
- TypeScriptのコンパイルが正常に動作
- ESLintでコード品質チェックが機能
- ウェルカム画面が表示される
- テーマ切り替えが機能する

**承認日**: 2025-09-07

---

### ✅ Phase 2: メイン画面レイアウト 【完了】
**目標**: spec.md/ui.mdに準拠した2ペイン構成のメイン画面作成

#### タスク詳細一覧 ✅
- [x] **UI-1**: ウェルカム画面からメイン画面への切り替え
  - 現在のウェルカム画面を置き換え
  - 2ペインレイアウトの基盤HTML構造作成
- [x] **UI-2**: 左側プロジェクト一覧ペイン構築
  - 固定幅250pxのサイドバー
  - プロジェクトフォルダ表示エリア（仮データ）
  - 選択状態のハイライト表示
- [x] **UI-3**: 右側ファイル一覧ペイン構築  
  - 可変幅のメインエリア（テーブル形式）
  - カラム：ファイル名（可変）、日時（140px）、サイズ（80px）
  - Finderライクなソート機能（▲▼矢印表示）
- [x] **UI-4**: ヘッダーツールバー実装
  - プロジェクト選択ドロップダウン削除（直接選択に変更）
  - [更新] [設定]ボタンをヘッダーに配置
  - ガラスエフェクト付きボタンデザイン
- [x] **UI-5**: 下部ステータスバー実装
  - 左側：処理状況（"Ready", "処理中..."）
  - 右側：選択中プロジェクト・ファイル数・選択ファイル情報
- [x] **UI-6**: 既存HTMLテーマCSS完全統合
  - 参考実装のカラーパレット適用
  - グラデーション・シャドウ効果
  - ダーク/ライトテーマ対応強化

#### 成果物 ✅
- **完全に動作する2ペインUI**: プロジェクト一覧 + ファイル一覧
- **プロジェクト別データ表示**: 各プロジェクトで異なるファイル一覧
- **Finderライクソート機能**: カラムヘッダークリックでソート・矢印表示
- **最適化されたレイアウト**: カラム幅調整・不要ヘッダー削除
- **レスポンシブ対応**: ウィンドウリサイズ対応
- **既存テーマ完全統合**: 既存HTML同等デザイン・ダーク/ライトテーマ
- **安定したF12操作**: DevTools開閉の安定動作
- **クリーンなコード**: デバッグログ削除済み

#### 作成された一時的なファイル（Phase 3で削除予定）
- `src/renderer/mockData.ts` - 仮データ定義（未使用）
- HTMLに直接埋め込まれた仮データ（projectFiles, mockProjects）

#### 完了確認ポイント ✅
- ✅ 2ペイン構成が美しく表示される
- ✅ 左側250px固定、右側可変幅レイアウト（カラム幅最適化済み）
- ✅ プロジェクト選択でファイル一覧が切り替わる
- ✅ ファイル一覧ソート機能（カラムヘッダークリック）
- ✅ ファイル選択・ダブルクリック動作
- ✅ ヘッダーボタン（更新・設定）動作確認
- ✅ ステータスバーに選択情報・ファイル数表示
- ✅ 既存HTMLテーマとの完全統一
- ✅ ダーク/ライトテーマ切り替え動作

**承認日**: 2025-09-07

#### 実装で使用する仮データ
```typescript
// プロジェクト仮データ
const mockProjects = [
  { name: "MyProject", path: "/path/to/project1" },
  { name: "TestProject", path: "/path/to/project2" },
  { name: "DemoApp", path: "/path/to/project3" }
];

// ファイル仮データ
const mockFiles = [
  { name: "session_001.jsonl", date: "2024-01-15 14:30", size: "1.2MB" },
  { name: "session_002.jsonl", date: "2024-01-14 09:15", size: "2.8MB" },
  { name: "session_003.jsonl", date: "2024-01-13 16:45", size: "0.9MB" }
];
```

---

### ✅ Phase 3: プロジェクト検出・一覧機能 【完了】
**目標**: ~/.claude/projectsからプロジェクトを検出・表示

#### タスク詳細一覧 ✅
- [x] **プロジェクト-0**: Phase 2仮データのクリーンアップ
  - `src/renderer/mockData.ts`の削除
  - HTML内の仮データ（mockProjects, projectFiles）をElectron IPCに置換
  - 仮データ表示ロジックを実データAPIコールに変更
- [x] **プロジェクト-1**: メイン・レンダラー間IPC通信設定
  - プリロードスクリプトにファイルシステムAPIを追加
  - メインプロセスにファイル操作ハンドラを実装
  - セキュアなcontextBridge経由でのAPI提供
- [x] **プロジェクト-2**: ~/.claude/projects検出ロジック実装
  - パスの存在確認（`fs.existsSync`）
  - ディレクトリ読み取り（`fs.readdir`）
  - フォルダのフィルタリング（ファイルは除外）
- [x] **プロジェクト-3**: プロジェクト一覧の実データ表示
  - IPC経由でのプロジェクトフォルダ取得
  - 既存UIでの実データ表示（仮データロジックと置換）
  - プロジェクト名のクリーンアップ（冗長パス除去）
- [x] **プロジェクト-4**: JSONLファイル検出・表示機能  
  - 選択されたプロジェクト内のJSONLファイル検索
  - ファイル情報取得（名前・mtime・サイズ）
  - 既存のソート機能との統合
- [x] **プロジェクト-5**: エラーハンドリング・ユーザー通知
  - ~/.claude/projectsが存在しない場合の処理
  - アクセス権限エラーの処理
  - エラーダイアログの実装

#### 成果物 ✅
- **完全な実データ統合**: ~/.claude/projectsから自動検出
- **実JSONLファイル表示**: ファイルシステムからの実データ
- **クリーンなプロジェクト名表示**: 冗長パス除去（HLGTimeLapse等）
- **右クリックFinder表示**: プロジェクト・ファイルのコンテキストメニュー
- **エラーハンドリング**: 適切なユーザー通知・ダイアログ
- **セキュアなアクセス**: contextIsolation=true維持

#### 完了確認ポイント ✅
- ✅ ~/.claude/projectsから実際のプロジェクトが読み取れる
- ✅ 実際のプロジェクトフォルダが一覧表示される（クリーンな名前）
- ✅ 実際のJSONLファイルがプロジェクト選択で表示される  
- ✅ ファイル情報（日時・サイズ）が正確に表示される
- ✅ ソート機能が実データで正常動作
- ✅ パスが存在しない場合のエラーダイアログ表示
- ✅ 右クリック → Finderで表示機能が動作

#### 追加で実装した機能
- **プロジェクト名クリーンアップ**: 冗長なパス部分の自動除去
- **右クリックコンテキストメニュー**: Finder表示機能
- **日時ソート修正**: 実データ対応の改良

**承認日**: 2025-09-07

---

### ✅ Phase 4: ファイル一覧・管理機能 【Phase 3で完了済み】
**目標**: 選択プロジェクト内のJSONLファイル表示

#### タスク一覧 ✅
- [x] **ファイル-1**: JSONLファイル検出ロジック（Phase 3で実装）
- [x] **ファイル-2**: ファイル情報取得（名前・日時・サイズ）（Phase 3で実装）
- [x] **ファイル-3**: Finderライクソート機能（Phase 2-3で実装）
- [x] **ファイル-4**: ファイル一覧UI表示（Phase 2-3で実装）
- [x] **ファイル-5**: ファイル選択機能（シングル・ダブルクリック）（Phase 2で実装）

**注記**: この機能群はPhase 2-3で統合実装済み

**承認日**: 2025-09-07

---

### ✅ Phase 5: claude-conversation-extractor連携 【完了】
**目標**: 外部ツールによるJSONL→MD→HTML変換機能の完全実装

#### 完了したタスク一覧 ✅
- [x] **変換-1**: claude-conversation-extractorバイナリ組み込み
  - Python venv環境でのclaude-extractインストール
  - 270個のセッション検出確認・変換テスト成功
- [x] **変換-2**: 子プロセス実行ロジック実装
  - Node.js child_process.spawnでの実行
  - プロジェクトディレクトリからの正確なパス実行
- [x] **変換-3**: 変換処理とエラーハンドリング
  - IPCハンドラの完全実装（JSONL→MD、MD→HTML）
  - プロジェクトディレクトリベースの変換処理
- [x] **変換-4**: MD→HTML変換エンジン実装
  - カスタムMarkdown→HTML変換関数
  - Claude会話に適したスタイリング
- [x] **変換-5**: 完全な変換フロー統合
  - JSONL→MD→HTML→モーダル表示の4段階処理
  - ステータス表示とエラーハンドリング

#### 実装された機能 ✅
- **完全な変換パイプライン**: JSONL→MD→HTML→表示の完全フロー
- **プロジェクトベース実行**: 各プロジェクトディレクトリからのclaude-extract実行
- **リアルタイムステータス表示**: 各段階での進捗表示
- **エラーハンドリング**: 各段階でのエラー検出と通知
- **HTMLモーダル表示**: 変換されたHTMLの美しい表示

#### 成果物 ✅
- **動作する変換機能**: ファイルダブルクリックで即座に変換・表示
- **カスタムHTML変換エンジン**: Markdown→HTML変換とスタイリング
- **完全なIPCインテグレーション**: メイン-レンダラー間の安全な通信
- **プロダクション品質の実装**: エラーハンドリング・ユーザーフィードバック

#### 確認ポイント ✅
- ✅ claude-extractコマンドが正常動作
- ✅ JSONL→MD変換が成功
- ✅ MD→HTML変換が成功
- ✅ HTMLモーダルが美しく表示
- ✅ エラー時の適切な通知
- ✅ ステータスバーでのリアルタイム進捗表示

**承認日**: 2025-09-07

**Phase 5で確立された変換システム**:
- 完全なJSONL→HTML変換パイプライン
- プロジェクトベースの実行環境
- エラーハンドリングとユーザーフィードバック
- モーダル表示によるリッチなHTML表示

---

### ✅ Phase 6: TypeScript環境移行・技術的課題解決 【完了】
**目標**: JavaScript構文エラー解決とTypeScript + Webpack環境構築

#### 解決した技術的課題 ✅
- **Electronファイルパス問題**: main.ts内のHTMLファイルパス修正完了
  - 正解: `path.join(__dirname, '../../renderer', 'index.html')`
- **プリロードスクリプト問題**: プリロードスクリプトパス修正完了
  - 正解: `path.join(__dirname, '../renderer', 'preload.js')`
- **ビルド環境**: TypeScript + Webpack環境が正常動作

#### 完了したタスク ✅
- [x] **環境-1**: Webpack環境構築
  - webpack, ts-loader, html-webpack-plugin追加完了
  - webpack.config.js設定済み
- [x] **環境-2**: TypeScriptファイル作成
  - src/renderer/renderer.ts作成完了
  - 型定義・基本機能実装済み
- [x] **環境-3**: ファイルパス問題解決
  - メインプロセスのHTMLパス修正完了
  - プリロードスクリプトパス調整完了
- [x] **環境-4**: アプリ動作確認
  - Electronアプリが正常起動
  - ビルドプロセスが安定動作
- [x] **環境-5**: 技術的基盤の確立
  - TypeScript環境での完全動作確認

#### 成果物 ✅
- **完全に動作するTypeScript + Webpack環境**: ビルド・開発環境
- **正しいファイルパス設定**: HTMLとプリロードスクリプトの適切な配置
- **安定したElectron起動**: パス問題解決による正常動作
- **Phase 1-3機能の維持**: 既存機能がTypeScript環境で動作

#### 確認ポイント ✅
- ✅ `npm run build` が正常にコンパイル完了
- ✅ `npm run dev` でElectronアプリが起動
- ✅ HTMLファイルが正しく読み込まれる
- ✅ プリロードスクリプトが正常に動作
- ✅ TypeScript環境での完全動作

**承認日**: 2025-09-07

**Phase 6で確立された技術基盤**:
- TypeScript + Webpack環境
- 正確なElectronファイルパス設定
- 安定したビルドプロセス
- Phase 1-3の全機能継承

---



### Phase 10: パッケージング・配布準備
**目標**: 本番配布用アプリケーション作成

#### タスク一覧
- [ ] **配布-1**: electron-builder最終設定
- [ ] **配布-2**: macOS .dmgビルド
- [ ] **配布-3**: 自動更新機能（electron-updater）
- [ ] **配布-4**: アプリアイコン・メタデータ
- [ ] **配布-5**: 配布テスト・最終調整

#### 成果物
- インストール可能な.dmgファイル
- 自動更新機能付き配布版アプリ

#### 確認ポイント  
- .dmgファイルが正常作成される
- インストール・起動が問題なし  
- 自動更新チェックが機能
- アプリの安定性確認

---

## 現在の全体進捗状況

### ✅ 完了済みフェーズ
- **Phase 1**: プロジェクト基盤構築 ✅
- **Phase 2**: メイン画面レイアウト ✅  
- **Phase 3**: プロジェクト検出・一覧機能 ✅
- **Phase 4**: ファイル一覧・管理機能 ✅（Phase 3で統合実装）
- **Phase 5**: claude-conversation-extractor連携 ✅
- **Phase 6**: TypeScript環境移行・技術的課題解決 ✅
- **🎯 TypeScript版claude-extractor実装**: Python依存関係完全排除 ✅
- **🌟 Tree View + HTML表示UI**: 直感的なFinder風ナビゲーション ✅
- **✅ Phase 7**: UI/UX大幅改善・エラーハンドリング強化 ✅
- **✅ Phase 8**: HTMLエクスポート機能・UI簡素化 ✅

### 🚀 次に実装するフェーズ
- **Phase 10**: パッケージング・配布準備

---

### ✅ **Phase 7実装完了**: UI/UX大幅改善・エラーハンドリング強化 【完了】
**目標**: 会話UI最適化、ファイル管理改善、小さなファイルへの対応

#### 完了したタスク一覧 ✅
- [x] **UI改善-1**: 会話表示UI完全再設計
  - 0から会話UIを再設計・シンプルな2層構造に変更
  - 3層構造（message → message-content → message-bubble）から2層（chat-msg + chat-icon + chat-text）に簡素化
  - HTML構造とCSS管理の統一化（インラインCSSのみに統一）
- [x] **UI改善-2**: 会話の視覚的区別強化
  - メッセージ間の余白最適化（無駄な隙間を削除）
  - アイコンと発言を同じ高さに配置（align-items: center）
  - ユーザー・Claude メッセージの明確な左右分離（80pxの非対称余白）
- [x] **UI改善-3**: 会話表示の色分け・背景設定
  - ユーザーメッセージ: 白背景 + 右寄せ配置
  - Claudeメッセージ: 薄いグレー背景(#f5f5f5) + 左寄せ配置
  - 白い背景でメッセージ境界を明確化
- [x] **ファイル管理-1**: ファイル情報表示の強化
  - Tree View にファイルサイズ表示を追加
  - 表示形式: "1.2MB | 2025/9/8 14:11" (サイズが日付の左)
- [x] **ファイル管理-2**: ファイルソート改善
  - ファイル並び順を日付の新しい順に変更（降順ソート）
  - 最新の会話が常に上に表示される仕様に改善
- [x] **エラーハンドリング-1**: 小さなファイル対応
  - メタメッセージのみのファイルでのエラー解消
  - "No valid conversation messages found" エラーを情報メッセージに変更
  - コマンドログのみのセッションへの適切な対応

#### 成果物 ✅
- **最適化された会話UI**: LINEやiMessage風の明確なチャット表示
- **強化されたファイル管理**: サイズ表示・日付ソート・Tree View最適化
- **改善されたエラー対応**: 空ファイルや小さなファイルの正常表示
- **統一されたCSS管理**: インラインCSSによる確実なスタイル適用

#### 技術的改善 ✅
- **CSS二重管理解消**: 外部CSSファイル削除、インラインCSS統一
- **会話構造簡素化**: 3層 → 2層構造でメンテナンス性向上
- **ソート最適化**: Tree View でのファイル表示最適化
- **エラーハンドリング強化**: より親切なエラーメッセージ表示

#### 確認ポイント ✅
- ✅ 会話メッセージが明確に区別される（ユーザー右・Claude左）
- ✅ 余白が最適化され、より多くの内容が表示可能
- ✅ ファイルサイズが Tree View に表示される
- ✅ 最新ファイルが常に上に表示される
- ✅ 小さなファイルでもエラーが出ずに情報表示される
- ✅ 長いURLが適切に折り返し表示される

**承認日**: 2025-09-08

---

### ✅ **Phase 8実装完了**: HTMLエクスポート機能・UI簡素化 【完了】
**目標**: HTMLエクスポート機能実装と不要機能の削除

#### 完了したタスク一覧 ✅
- [x] **エクスポート-1**: HTMLエクスポート機能完全実装
  - エクスポートダイアログUI作成（420px幅モーダル）
  - ファイル情報表示（セッションID、サイズ、日付）
  - HTML形式のみに特化した簡潔な設計
- [x] **エクスポート-2**: IPCハンドラ・API統合
  - メインプロセスに`export-html`ハンドラ追加
  - `dialog.showSaveDialog()`でシステム保存ダイアログ
  - TypeScript型定義付きの安全なAPI設計
- [x] **エクスポート-3**: ファイル保存・エラーハンドリング
  - スタンドアロンHTMLファイル保存（インラインCSS付き）
  - 詳細なエラーメッセージ・ダイアログ表示
  - ファイル名自動生成：`Session_{ID}_{日付}.html`
- [x] **UI簡素化-1**: 不要機能の削除
  - PDF出力機能の完全削除（品質不良のため）
  - 🔍検索機能の削除（不要のため）
  - ⚙️設定機能の削除（特に設定項目なし）
- [x] **UI簡素化-2**: UIの洗練化
  - ヘッダーボタン：🔄更新のみに簡素化
  - ツールバー：📋全選択 | 📄コピー | 📤エクスポート
  - エクスポートダイアログ：HTML単一形式で迷いなし

#### 成果物 ✅
- **完全なHTMLエクスポート機能**: ワンクリックでスタンドアロンHTML保存
- **洗練されたUI**: 必要な機能のみの美しいインターフェース
- **エラーフリー**: 複雑なPDF処理削除で安定性向上
- **自動ファイル名**: セッションIDと日付から自動生成

#### 技術的改善 ✅
- **シンプルな保存処理**: HTML文字列の直接書き込み
- **システム統合**: ネイティブファイル保存ダイアログ
- **TypeScript安全性**: 完全な型定義とエラーハンドリング
- **コード削減**: 不要機能削除で保守性向上

#### 確認ポイント ✅
- ✅ 📤ボタンクリックでエクスポートダイアログが表示される
- ✅ ファイル情報（セッションID・サイズ・日付）が正確に表示
- ✅ HTMLファイルが正常に保存される
- ✅ 保存完了メッセージとファイルパスが表示される
- ✅ エラー時の適切な通知・ダイアログ
- ✅ UI不要機能削除でスッキリした操作感

**承認日**: 2025-09-08

---

### 🎉 **現在の状況まとめ（Phase 8完了版）**
- **完全なTree View UI**: Finder風の階層ナビゲーション + 即座HTML表示
- **TypeScript化完了**: Python依存関係削除、270MBバイナリ削除、外部プロセス不要
- **出力品質向上**: 元版準拠の23KB出力（98%サイズ削減成功）
- **最適化された会話UI**: チャット風UI・明確な視覚区別・余白最適化
- **強化されたファイル管理**: サイズ表示・日付ソート・エラーハンドリング
- **完全なHTMLエクスポート**: ワンクリックでスタンドアロンHTML保存
- **洗練されたUI**: 必要機能のみ（更新・全選択・コピー・エクスポート）

### 🏁 **プロダクション品質達成（v3.0 - 完成版）**
- **Core機能100%完成**: Tree View + 会話表示 + HTMLエクスポート
- **元版同等品質**: claude-conversation-extractorと同じ出力結果
- **完全なGUIビューア**: 美しく直感的なデスクトップアプリ
- **エンタープライズ品質**: 安定性・保守性・ユーザビリティを完全達成

**次のアクション**: Phase 10のパッケージング・配布準備
# Claude Code Viewer 実装計画

## 運用ルール

### 1. フェーズベース開発
- 各フェーズは独立した機能単位で構成
- フェーズ完了時に動作確認可能な成果物を提供
- 全フェーズ完了後に統合・最終調整を実施

### 2. 承認プロセス
- 各フェーズ完了時に成果物を提示
- ユーザーが実際にアプリを実行して動作確認
- 承認取得後に次フェーズへ進行
- 修正要望があれば該当フェーズ内で対応

### 3. 成果物の要件
- 動作するElectronアプリケーション
- 該当機能が実際に使用可能
- TypeScript + ESLint構成済み
- 実装内容と確認ポイントをドキュメント化

### 4. 進捗管理
- 各フェーズのタスク状態を明記
- 完了条件と確認事項を定義
- 依存関係と前提条件を整理

---

## フェーズ別実装計画

### ✅ Phase 1: プロジェクト基盤構築 【完了】
**目標**: Electronプロジェクトの初期設定とTypeScript環境構築

#### タスク一覧
- [x] **基盤-1**: Electronプロジェクト初期化
- [x] **基盤-2**: TypeScript設定 (tsconfig.json)
- [x] **基盤-3**: ESLint + Prettier設定
- [x] **基盤-4**: electron-builder設定
- [x] **基盤-5**: 基本的なメイン・レンダラープロセス構成

#### 成果物 ✅
- 起動可能なElectronアプリ（ウェルカム画面）
- ビルド・開発環境一式
- VSCode F5デバッグ実行対応
- F12キーによるDevTools開閉
- ウィンドウ終了時アプリ終了

#### 確認ポイント ✅
- `npm run dev` でアプリが起動する
- TypeScriptのコンパイルが正常に動作
- ESLintでコード品質チェックが機能
- ウェルカム画面が表示される
- テーマ切り替えが機能する

**承認日**: 2025-09-07

---

### ✅ Phase 2: メイン画面レイアウト 【完了】
**目標**: spec.md/ui.mdに準拠した2ペイン構成のメイン画面作成

#### タスク詳細一覧 ✅
- [x] **UI-1**: ウェルカム画面からメイン画面への切り替え
  - 現在のウェルカム画面を置き換え
  - 2ペインレイアウトの基盤HTML構造作成
- [x] **UI-2**: 左側プロジェクト一覧ペイン構築
  - 固定幅250pxのサイドバー
  - プロジェクトフォルダ表示エリア（仮データ）
  - 選択状態のハイライト表示
- [x] **UI-3**: 右側ファイル一覧ペイン構築  
  - 可変幅のメインエリア（テーブル形式）
  - カラム：ファイル名（可変）、日時（140px）、サイズ（80px）
  - Finderライクなソート機能（▲▼矢印表示）
- [x] **UI-4**: ヘッダーツールバー実装
  - プロジェクト選択ドロップダウン削除（直接選択に変更）
  - [更新] [設定]ボタンをヘッダーに配置
  - ガラスエフェクト付きボタンデザイン
- [x] **UI-5**: 下部ステータスバー実装
  - 左側：処理状況（"Ready", "処理中..."）
  - 右側：選択中プロジェクト・ファイル数・選択ファイル情報
- [x] **UI-6**: 既存HTMLテーマCSS完全統合
  - 参考実装のカラーパレット適用
  - グラデーション・シャドウ効果
  - ダーク/ライトテーマ対応強化

#### 成果物 ✅
- **完全に動作する2ペインUI**: プロジェクト一覧 + ファイル一覧
- **プロジェクト別データ表示**: 各プロジェクトで異なるファイル一覧
- **Finderライクソート機能**: カラムヘッダークリックでソート・矢印表示
- **最適化されたレイアウト**: カラム幅調整・不要ヘッダー削除
- **レスポンシブ対応**: ウィンドウリサイズ対応
- **既存テーマ完全統合**: 既存HTML同等デザイン・ダーク/ライトテーマ
- **安定したF12操作**: DevTools開閉の安定動作
- **クリーンなコード**: デバッグログ削除済み

#### 作成された一時的なファイル（Phase 3で削除予定）
- `src/renderer/mockData.ts` - 仮データ定義（未使用）
- HTMLに直接埋め込まれた仮データ（projectFiles, mockProjects）

#### 完了確認ポイント ✅
- ✅ 2ペイン構成が美しく表示される
- ✅ 左側250px固定、右側可変幅レイアウト（カラム幅最適化済み）
- ✅ プロジェクト選択でファイル一覧が切り替わる
- ✅ ファイル一覧ソート機能（カラムヘッダークリック）
- ✅ ファイル選択・ダブルクリック動作
- ✅ ヘッダーボタン（更新・設定）動作確認
- ✅ ステータスバーに選択情報・ファイル数表示
- ✅ 既存HTMLテーマとの完全統一
- ✅ ダーク/ライトテーマ切り替え動作

**承認日**: 2025-09-07

#### 実装で使用する仮データ
```typescript
// プロジェクト仮データ
const mockProjects = [
  { name: "MyProject", path: "/path/to/project1" },
  { name: "TestProject", path: "/path/to/project2" },
  { name: "DemoApp", path: "/path/to/project3" }
];

// ファイル仮データ
const mockFiles = [
  { name: "session_001.jsonl", date: "2024-01-15 14:30", size: "1.2MB" },
  { name: "session_002.jsonl", date: "2024-01-14 09:15", size: "2.8MB" },
  { name: "session_003.jsonl", date: "2024-01-13 16:45", size: "0.9MB" }
];
```

---

### ✅ Phase 3: プロジェクト検出・一覧機能 【完了】
**目標**: ~/.claude/projectsからプロジェクトを検出・表示

#### タスク詳細一覧 ✅
- [x] **プロジェクト-0**: Phase 2仮データのクリーンアップ
  - `src/renderer/mockData.ts`の削除
  - HTML内の仮データ（mockProjects, projectFiles）をElectron IPCに置換
  - 仮データ表示ロジックを実データAPIコールに変更
- [x] **プロジェクト-1**: メイン・レンダラー間IPC通信設定
  - プリロードスクリプトにファイルシステムAPIを追加
  - メインプロセスにファイル操作ハンドラを実装
  - セキュアなcontextBridge経由でのAPI提供
- [x] **プロジェクト-2**: ~/.claude/projects検出ロジック実装
  - パスの存在確認（`fs.existsSync`）
  - ディレクトリ読み取り（`fs.readdir`）
  - フォルダのフィルタリング（ファイルは除外）
- [x] **プロジェクト-3**: プロジェクト一覧の実データ表示
  - IPC経由でのプロジェクトフォルダ取得
  - 既存UIでの実データ表示（仮データロジックと置換）
  - プロジェクト名のクリーンアップ（冗長パス除去）
- [x] **プロジェクト-4**: JSONLファイル検出・表示機能  
  - 選択されたプロジェクト内のJSONLファイル検索
  - ファイル情報取得（名前・mtime・サイズ）
  - 既存のソート機能との統合
- [x] **プロジェクト-5**: エラーハンドリング・ユーザー通知
  - ~/.claude/projectsが存在しない場合の処理
  - アクセス権限エラーの処理
  - エラーダイアログの実装

#### 成果物 ✅
- **完全な実データ統合**: ~/.claude/projectsから自動検出
- **実JSONLファイル表示**: ファイルシステムからの実データ
- **クリーンなプロジェクト名表示**: 冗長パス除去（HLGTimeLapse等）
- **右クリックFinder表示**: プロジェクト・ファイルのコンテキストメニュー
- **エラーハンドリング**: 適切なユーザー通知・ダイアログ
- **セキュアなアクセス**: contextIsolation=true維持

#### 完了確認ポイント ✅
- ✅ ~/.claude/projectsから実際のプロジェクトが読み取れる
- ✅ 実際のプロジェクトフォルダが一覧表示される（クリーンな名前）
- ✅ 実際のJSONLファイルがプロジェクト選択で表示される  
- ✅ ファイル情報（日時・サイズ）が正確に表示される
- ✅ ソート機能が実データで正常動作
- ✅ パスが存在しない場合のエラーダイアログ表示
- ✅ 右クリック → Finderで表示機能が動作

#### 追加で実装した機能
- **プロジェクト名クリーンアップ**: 冗長なパス部分の自動除去
- **右クリックコンテキストメニュー**: Finder表示機能
- **日時ソート修正**: 実データ対応の改良

**承認日**: 2025-09-07

---

### ✅ Phase 4: ファイル一覧・管理機能 【Phase 3で完了済み】
**目標**: 選択プロジェクト内のJSONLファイル表示

#### タスク一覧 ✅
- [x] **ファイル-1**: JSONLファイル検出ロジック（Phase 3で実装）
- [x] **ファイル-2**: ファイル情報取得（名前・日時・サイズ）（Phase 3で実装）
- [x] **ファイル-3**: Finderライクソート機能（Phase 2-3で実装）
- [x] **ファイル-4**: ファイル一覧UI表示（Phase 2-3で実装）
- [x] **ファイル-5**: ファイル選択機能（シングル・ダブルクリック）（Phase 2で実装）

**注記**: この機能群はPhase 2-3で統合実装済み

**承認日**: 2025-09-07

---

### ✅ Phase 5: claude-conversation-extractor連携 【完了】
**目標**: 外部ツールによるJSONL→MD→HTML変換機能の完全実装

#### 完了したタスク一覧 ✅
- [x] **変換-1**: claude-conversation-extractorバイナリ組み込み
  - Python venv環境でのclaude-extractインストール
  - 270個のセッション検出確認・変換テスト成功
- [x] **変換-2**: 子プロセス実行ロジック実装
  - Node.js child_process.spawnでの実行
  - プロジェクトディレクトリからの正確なパス実行
- [x] **変換-3**: 変換処理とエラーハンドリング
  - IPCハンドラの完全実装（JSONL→MD、MD→HTML）
  - プロジェクトディレクトリベースの変換処理
- [x] **変換-4**: MD→HTML変換エンジン実装
  - カスタムMarkdown→HTML変換関数
  - Claude会話に適したスタイリング
- [x] **変換-5**: 完全な変換フロー統合
  - JSONL→MD→HTML→モーダル表示の4段階処理
  - ステータス表示とエラーハンドリング

#### 実装された機能 ✅
- **完全な変換パイプライン**: JSONL→MD→HTML→表示の完全フロー
- **プロジェクトベース実行**: 各プロジェクトディレクトリからのclaude-extract実行
- **リアルタイムステータス表示**: 各段階での進捗表示
- **エラーハンドリング**: 各段階でのエラー検出と通知
- **HTMLモーダル表示**: 変換されたHTMLの美しい表示

#### 成果物 ✅
- **動作する変換機能**: ファイルダブルクリックで即座に変換・表示
- **カスタムHTML変換エンジン**: Markdown→HTML変換とスタイリング
- **完全なIPCインテグレーション**: メイン-レンダラー間の安全な通信
- **プロダクション品質の実装**: エラーハンドリング・ユーザーフィードバック

#### 確認ポイント ✅
- ✅ claude-extractコマンドが正常動作
- ✅ JSONL→MD変換が成功
- ✅ MD→HTML変換が成功
- ✅ HTMLモーダルが美しく表示
- ✅ エラー時の適切な通知
- ✅ ステータスバーでのリアルタイム進捗表示

**承認日**: 2025-09-07

**Phase 5で確立された変換システム**:
- 完全なJSONL→HTML変換パイプライン
- プロジェクトベースの実行環境
- エラーハンドリングとユーザーフィードバック
- モーダル表示によるリッチなHTML表示

---

### ✅ Phase 6: TypeScript環境移行・技術的課題解決 【完了】
**目標**: JavaScript構文エラー解決とTypeScript + Webpack環境構築

#### 解決した技術的課題 ✅
- **Electronファイルパス問題**: main.ts内のHTMLファイルパス修正完了
  - 正解: `path.join(__dirname, '../../renderer', 'index.html')`
- **プリロードスクリプト問題**: プリロードスクリプトパス修正完了
  - 正解: `path.join(__dirname, '../renderer', 'preload.js')`
- **ビルド環境**: TypeScript + Webpack環境が正常動作

#### 完了したタスク ✅
- [x] **環境-1**: Webpack環境構築
  - webpack, ts-loader, html-webpack-plugin追加完了
  - webpack.config.js設定済み
- [x] **環境-2**: TypeScriptファイル作成
  - src/renderer/renderer.ts作成完了
  - 型定義・基本機能実装済み
- [x] **環境-3**: ファイルパス問題解決
  - メインプロセスのHTMLパス修正完了
  - プリロードスクリプトパス調整完了
- [x] **環境-4**: アプリ動作確認
  - Electronアプリが正常起動
  - ビルドプロセスが安定動作
- [x] **環境-5**: 技術的基盤の確立
  - TypeScript環境での完全動作確認

#### 成果物 ✅
- **完全に動作するTypeScript + Webpack環境**: ビルド・開発環境
- **正しいファイルパス設定**: HTMLとプリロードスクリプトの適切な配置
- **安定したElectron起動**: パス問題解決による正常動作
- **Phase 1-3機能の維持**: 既存機能がTypeScript環境で動作

#### 確認ポイント ✅
- ✅ `npm run build` が正常にコンパイル完了
- ✅ `npm run dev` でElectronアプリが起動
- ✅ HTMLファイルが正しく読み込まれる
- ✅ プリロードスクリプトが正常に動作
- ✅ TypeScript環境での完全動作

**承認日**: 2025-09-07

**Phase 6で確立された技術基盤**:
- TypeScript + Webpack環境
- 正確なElectronファイルパス設定
- 安定したビルドプロセス
- Phase 1-3の全機能継承

---

### 🚀 Phase 7: 統合テスト・最適化 【Phase 6後に実装】
**目標**: 全機能の統合・パフォーマンス最適化

#### タスク詳細一覧  
- [ ] **統合-1**: 全機能の統合テスト
  - JSONL選択→MD変換→HTML表示→モーダルの完全なフロー
  - 大量ファイルでのパフォーマンステスト
  - メモリ使用量・処理速度の最適化
- [ ] **統合-2**: キャッシュ効果の検証
  - 初回変換 vs 2回目以降の高速表示
  - キャッシュ無効化の正確な動作
  - ディスク使用量の管理
- [ ] **統合-3**: エラーシナリオの網羅テスト
  - フォルダなし・ファイル破損・権限エラー等
  - ネットワーク切断・プロセス異常終了
  - ユーザーの予期しない操作への対応
- [ ] **統合-4**: UI/UXの最終調整
  - レスポンシブ動作の確認
  - アクセシビリティ対応
  - ショートカットキーの完全動作
- [ ] **統合-5**: 本番準備・クリーンアップ
  - デバッグコード削除
  - パフォーマンス監視
  - メモリリーク対策

#### 成果物
- **完全統合されたアプリ**: 全機能が連携動作
- **最適化された性能**: 高速・安定動作
- **本番品質のコード**: デバッグコード削除・クリーンアップ済み

---

### Phase 8: エクスポート機能
**目標**: HTML/PDF形式でのエクスポート

#### タスク一覧
- [ ] **エクスポート-1**: エクスポートダイアログ
- [ ] **エクスポート-2**: HTML出力機能
- [ ] **エクスポート-3**: PDF変換機能（printToPDF）
- [ ] **エクスポート-4**: ファイル保存処理
- [ ] **エクスポート-5**: エクスポート完了通知

#### 成果物  
- HTML/PDFエクスポート機能
- ファイル保存ダイアログ

#### 確認ポイント
- エクスポートダイアログが表示される
- HTMLファイルが正常出力される
- PDFが適切に生成される
- 保存先選択が機能

---

### Phase 9: 設定・テーマ機能
**目標**: アプリ設定とテーマシステム

#### タスク一覧
- [ ] **設定-1**: 設定ダイアログ作成
- [ ] **設定-2**: Claude Projectsパス設定
- [ ] **設定-3**: システムテーマ連動
- [ ] **設定-4**: キャッシュ管理機能
- [ ] **設定-5**: 設定値永続化

#### 成果物
- 設定機能付きアプリ  
- ダーク・ライトテーマ対応

#### 確認ポイント
- 設定ダイアログが正常動作
- パス設定変更が反映される
- テーマが自動切り替わる
- キャッシュクリア機能

---

### Phase 10: パッケージング・配布準備
**目標**: 本番配布用アプリケーション作成

#### タスク一覧
- [ ] **配布-1**: electron-builder最終設定
- [ ] **配布-2**: macOS .dmgビルド
- [ ] **配布-3**: 自動更新機能（electron-updater）
- [ ] **配布-4**: アプリアイコン・メタデータ
- [ ] **配布-5**: 配布テスト・最終調整

#### 成果物
- インストール可能な.dmgファイル
- 自動更新機能付き配布版アプリ

#### 確認ポイント  
- .dmgファイルが正常作成される
- インストール・起動が問題なし  
- 自動更新チェックが機能
- アプリの安定性確認

---

## 現在の全体進捗状況

### ✅ 完了済みフェーズ
- **Phase 1**: プロジェクト基盤構築 ✅
- **Phase 2**: メイン画面レイアウト ✅  
- **Phase 3**: プロジェクト検出・一覧機能 ✅
- **Phase 4**: ファイル一覧・管理機能 ✅（Phase 3で統合実装）
- **Phase 5**: claude-conversation-extractor連携 ✅
- **Phase 6**: TypeScript環境移行・技術的課題解決 ✅
- **🎯 TypeScript版claude-extractor実装**: Python依存関係完全排除 ✅

### 🚀 次に実装するフェーズ
- **Phase 7**: 統合テスト・最適化
- **Phase 8**: エクスポート機能
- **Phase 9**: 設定・テーマ機能
- **Phase 10**: パッケージング・配布準備

### 🎉 **現在の状況まとめ**
- **完全な変換機能**: JSONL→MD→HTML→モーダル表示の完全フロー実装
- **TypeScript化完了**: Python依存関係削除、270MBバイナリ削除、外部プロセス不要
- **コード簡略化**: main.ts 25%削減（790行→588行）、複雑なセッション管理ロジック削除
- **パフォーマンス向上**: 直接TypeScript実行による高速化
- **安定動作環境**: TypeScript + Webpack環境が完全動作

**次のアクション**: Phase 7の統合テスト・最適化またはPhase 8のエクスポート機能実装